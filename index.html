<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LeaderTV – Начало</title>
  <meta name="color-scheme" content="light only" />
  <style>
    :root{
      --bg:#f6f7fb;
      --fg:#0f172a;
      --muted:#6b7280;
      --green:#16a34a;
      --green-600:#16a34a;
      --green-700:#15803d;
      --card:#ffffff;
      --ring:#e5e7eb;
    }
    *{box-sizing:border-box}
    body{margin:0;font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;color:var(--fg);background:var(--bg);}
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1100px;margin:0 auto;padding:0 20px}
    header{background:#fff;border-bottom:1px solid var(--ring)}
    .nav{display:flex;align-items:center;gap:24px;height:64px}
    .brand{font-weight:800}
    .links{display:flex;gap:16px;margin-left:auto}
    .links a{opacity:.85}
    .links a:hover{opacity:1}
    .hero{background:linear-gradient(0deg,#eaf8ee 0,#f4fbf6 100%);padding:42px 0;border-bottom:1px solid var(--ring)}
    .hero h1{margin:0 0 8px;font-size:32px;letter-spacing:.2px}
    .hero p{margin:0;color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin:28px 0 48px}
    .card{background:var(--card);border:1px solid var(--ring);border-radius:14px;padding:18px 18px}
    .card h3{margin:2px 0 14px;font-size:18px}
    .item{padding:14px 0;border-top:1px dashed var(--ring)}
    .item:first-child{border-top:none}
    .title{font-weight:600}
    .date{color:var(--muted);font-size:14px;margin-top:2px}
    footer{padding:36px 0;color:var(--muted);text-align:center;border-top:1px solid var(--ring);background:#fff}
    .err{margin-top:6px;color:#b91c1c;font-size:14px}
    .badge{display:inline-block;background:var(--green-600);color:#fff;padding:2px 8px;border-radius:999px;font-size:12px;margin-left:8px}
  </style>
</head>
<body>
  <header>
    <div class="wrap nav">
      <div class="brand">LeaderTV</div>
      <nav class="links">
        <a href="/">Начало</a>
        <a href="/#news">Новини</a>
        <a href="/#events">Събития</a>
        <a href="/admin.html">Админ</a>
      </nav>
    </div>
  </header>

  <section class="hero">
    <div class="wrap">
      <h1>Добре дошли в LeaderTV</h1>
      <p>Платформа за новини и събития на МИГ и партньорски организации.</p>
    </div>
  </section>

  <main class="wrap">
    <div class="grid">
      <section id="news" class="card">
        <h3>Последни новини <span id="newsCount" class="badge" style="display:none"></span></h3>
        <div id="newsList"></div>
        <div id="newsErr" class="err" hidden></div>
      </section>

      <section id="events" class="card">
        <h3>Предстоящи събития <span id="eventsCount" class="badge" style="display:none"></span></h3>
        <div id="eventsList"></div>
        <div id="eventsErr" class="err" hidden></div>
      </section>
    </div>
  </main>

  <footer>
    © 2025 LeaderTV. Всички права запазени.
  </footer>

  <script>
    // === НАСТРОЙКА НА API БАЗА ===
    const API_BASE = "https://leadertv-backend-production.up.railway.app/api";

    const fmtDate = s => {
      try {
        const d = new Date(s);
        return d.toLocaleDateString("bg-BG", {year:"numeric", month:"2-digit", day:"2-digit"});
      } catch { return s; }
    };

    async function loadNews(){
      const box = document.getElementById("newsList");
      const err = document.getElementById("newsErr");
      const badge = document.getElementById("newsCount");
      box.innerHTML = ""; err.hidden = true;
      try{
        const res = await fetch(`${API_BASE}/news`, {cache:"no-store"});
        if(!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        if(Array.isArray(data) && data.length){
          badge.style.display="inline-block";
          badge.textContent = data.length;
          data.slice(0,3).forEach(n=>{
            const div = document.createElement("div");
            div.className="item";
            div.innerHTML = `
              <div class="title">${n.title ?? ""}</div>
              <div class="date">${fmtDate(n.date)}</div>
              <div>${(n.body ?? "").replace(/\n/g,"<br>")}</div>
            `;
            box.appendChild(div);
          });
        } else {
          box.innerHTML = `<div class="item">Няма записи.</div>`;
        }
      }catch(e){
        err.hidden = false;
        err.textContent = "Проблем при зареждане на новините.";
        box.innerHTML = `<div class="item">Няма записи.</div>`;
      }
    }

    async function loadEvents(){
      const box = document.getElementById("eventsList");
      const err = document.getElementById("eventsErr");
      const badge = document.getElementById("eventsCount");
      box.innerHTML = ""; err.hidden = true;
      try{
        const res = await fetch(`${API_BASE}/events`, {cache:"no-store"});
        if(!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        if(Array.isArray(data) && data.length){
          badge.style.display="inline-block";
          badge.textContent = data.length;
          data.slice(0,3).forEach(ev=>{
            const div = document.createElement("div");
            div.className="item";
            div.innerHTML = `
              <div class="title">${ev.title ?? ""}</div>
              <div class="date">${fmtDate(ev.date)}${ev.location? " · " + ev.location : ""}</div>
            `;
            box.appendChild(div);
          });
        } else {
          box.innerHTML = `<div class="item">Няма записи.</div>`;
        }
      }catch(e){
        err.hidden = false;
        err.textContent = "Проблем при зареждане на събитията.";
        box.innerHTML = `<div class="item">Няма записи.</div>`;
      }
    }

    loadNews();
    loadEvents();
  </script>
</body>
</html>
