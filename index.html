<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LeaderTV – Начало</title>
  <style>
    :root { --fg:#0b1220; --muted:#6b7280; --card:#fff; --bg:#f6f7fb; --brand:#2563eb; }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    a{color:var(--brand);text-decoration:none}
    header{background:#fff;border-bottom:1px solid #eceff5}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .nav{display:flex;gap:16px;align-items:center;flex-wrap:wrap}
    .brand{font-weight:700}
    main .grid{display:grid;gap:16px;grid-template-columns:1fr;align-items:start}
    @media (min-width: 900px){ main .grid{grid-template-columns:1fr 1fr} }
    .card{background:var(--card);border:1px solid #e8ebf2;border-radius:12px;padding:18px}
    h1{font-size:28px;margin:10px 0 8px}
    h2{font-size:20px;margin:0 0 10px}
    ul{list-style:none;margin:0;padding:0}
    li{padding:10px 0;border-top:1px solid #eef1f6}
    li:first-child{border-top:0}
    .meta{color:var(--muted);font-size:14px;margin-top:2px}
    .empty{color:var(--muted)}
    footer{color:var(--muted);padding:24px 0;text-align:center}
    .hero{padding:24px 0}
    .hero p{margin:.25rem 0;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="wrap nav">
      <div class="brand">LeaderTV</div>
      <nav style="margin-left:auto;display:flex;gap:14px;">
        <a href="/">Начало</a>
        <a href="/news">Новини</a>
        <a href="/events">Събития</a>
        <a href="/admin">Админ</a>
      </nav>
    </div>
  </header>

  <div class="wrap hero">
    <h1>Добре дошли в LeaderTV</h1>
    <p>Платформа за новини и събития на МИГ и партньорски организации.</p>
  </div>

  <main class="wrap">
    <div class="grid">
      <section class="card" id="news-card">
        <h2>Последни новини</h2>
        <ul id="home-news"><li class="empty">Зареждане…</li></ul>
      </section>

      <section class="card" id="events-card">
        <h2>Предстоящи събития</h2>
        <ul id="home-events"><li class="empty">Зареждане…</li></ul>
      </section>
    </div>
  </main>

  <footer class="wrap">© 2025 LeaderTV. Всички права запазени.</footer>

  <script>
    (function(){
      const API = 'https://leadertv-backend-production.up.railway.app/api';

      const fmtDate = (d) => {
        if(!d) return '';
        const t = new Date(d);
        if (isNaN(t)) return d;
        const y = t.getFullYear();
        const m = String(t.getMonth()+1).padStart(2,'0');
        const dd = String(t.getDate()).padStart(2,'0');
        return `${y}-${m}-${dd}`;
      };

      async function loadNews(){
        const ul = document.getElementById('home-news');
        try {
          const res = await fetch(`${API}/news`);
          const data = await res.json();
          const items = (data||[])
            .sort((a,b)=> String(b.date).localeCompare(String(a.date)))
            .slice(0,3);
          ul.innerHTML='';
          if(!items.length){ ul.innerHTML = '<li class="empty">Няма записи.</li>'; return; }
          for(const n of items){
            const li = document.createElement('li');
            const title = document.createElement('div');
            title.textContent = n.title || '(без заглавие)';
            title.style.fontWeight='600';
            const meta = document.createElement('div');
            meta.className='meta';
            meta.textContent = fmtDate(n.date);
            const body = document.createElement('div');
            if(n.body){ body.textContent = n.body; body.style.marginTop='4px'; }
            li.appendChild(title);
            li.appendChild(meta);
            if(n.body) li.appendChild(body);
            ul.appendChild(li);
          }
        } catch(e){
          console.error(e);
          ul.innerHTML = '<li class="empty" style="color:#b00">Грешка при зареждане.</li>';
        }
      }

      async function loadEvents(){
        const ul = document.getElementById('home-events');
        try {
          const res = await fetch(`${API}/events`);
          const data = await res.json();
          const today = new Date().toISOString().slice(0,10);
          const items = (data||[])
            .filter(e => !e.date || String(e.date) >= today)
            .sort((a,b)=> String(a.date).localeCompare(String(b.date)))
            .slice(0,3);
          ul.innerHTML='';
          if(!items.length){ ul.innerHTML = '<li class="empty">Няма записи.</li>'; return; }
          for(const ev of items){
            const li = document.createElement('li');
            const title = document.createElement('div');
            title.textContent = ev.title || '(без заглавие)';
            title.style.fontWeight='600';
            const meta = document.createElement('div');
            meta.className='meta';
            meta.textContent = [fmtDate(ev.date), ev.location].filter(Boolean).join(' · ');
            li.appendChild(title);
            li.appendChild(meta);
            ul.appendChild(li);
          }
        } catch(e){
          console.error(e);
          ul.innerHTML = '<li class="empty" style="color:#b00">Грешка при зареждане.</li>';
        }
      }

      document.addEventListener('DOMContentLoaded', () => {
        loadNews();
        loadEvents();
      });
    })();
  </script>
</body>
</html>
